tinymce.PluginManager.add("importcss",function(t){function e(t){var e=tinymce.Env.cacheSuffix;return"string"==typeof t&&(t=t.replace("?"+e,"").replace("&"+e,"")),t}function n(e){var n=t.settings,i=!1!==n.skin&&(n.skin||"lightgray");if(i){var r=n.skin_url;return r=r?t.documentBaseURI.toAbsolute(r):tinymce.baseURL+"/skins/"+i,e===r+"/content"+(t.inline?".inline":"")+".min.css"}return!1}function i(t){return"string"==typeof t?function(e){return-1!==e.indexOf(t)}:t instanceof RegExp?function(e){return t.test(e)}:t}function r(i,r){function s(t,i){var o,l=t.href;if((l=e(l))&&r(l,i)&&!n(l)){p(t.imports,function(t){s(t,!0)});try{o=t.cssRules||t.rules}catch(t){}p(o,function(t){t.styleSheet?s(t.styleSheet,!0):t.selectorText&&p(t.selectorText.split(","),function(t){c.push(tinymce.trim(t))})})}}var c=[],o={};p(t.contentCSS,function(t){o[t]=!0}),r||(r=function(t,e){return e||o[t]});try{p(i.styleSheets,function(t){s(t)})}finally{}return c}function s(e){var n,i=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(e);if(i){var r=i[1],s=i[2].substr(1).split(".").join(" "),c=tinymce.makeMap("a,img");return i[1]?(n={title:e},t.schema.getTextBlockElements()[r]?n.block=r:t.schema.getBlockElements()[r]||c[r.toLowerCase()]?n.selector=r:n.inline=r):i[2]&&(n={inline:"span",title:e.substr(1),classes:s}),!1!==t.settings.importcss_merge_classes?n.classes=s:n.attributes={"class":s},n}}function c(t,e){return tinymce.util.Tools.grep(t,function(t){return!t.filter||t.filter(e)})}function o(t){return tinymce.util.Tools.map(t,function(t){return tinymce.util.Tools.extend({},t,{original:t,selectors:{},filter:i(t.filter),item:{text:t.title,menu:[]}})})}function l(t,e){return null===e||!1!==t.settings.importcss_exclusive}function u(e,n,i){return!(l(t,n)?e in i:e in n.selectors)}function a(e,n,i){l(t,n)?i[e]=!0:n.selectors[e]=!0}function f(e,n,i){var r,c=t.settings;return r=i&&i.selector_converter?i.selector_converter:c.importcss_selector_converter?c.importcss_selector_converter:s,r.call(e,n,i)}var m=this,p=tinymce.each;t.on("renderFormatsMenu",function(e){var n=t.settings,s={},l=i(n.importcss_selector_filter),g=e.control,v=o(n.importcss_groups),y=function(e,n){if(u(e,n,s)){a(e,n,s);var i=f(m,e,n);if(i){var r=i.name||tinymce.DOM.uniqueId();return t.formatter.register(r,i),tinymce.extend({},g.settings.itemDefaults,{text:i.title,format:r})}}return null};t.settings.importcss_append||g.items().remove(),p(r(e.doc||t.getDoc(),i(n.importcss_file_filter)),function(t){if(-1===t.indexOf(".mce-")&&(!l||l(t))){var e=c(v,t);if(e.length>0)tinymce.util.Tools.each(e,function(e){var n=y(t,e);n&&e.item.menu.push(n)});else{var n=y(t,null);n&&g.add(n)}}}),p(v,function(t){t.item.menu.length>0&&g.add(t.item)}),e.control.renderNew()}),m.convertSelectorToFormat=s});