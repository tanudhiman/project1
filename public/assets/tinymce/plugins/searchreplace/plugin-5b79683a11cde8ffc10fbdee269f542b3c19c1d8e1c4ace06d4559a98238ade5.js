!function(){function e(e){return e&&1==e.nodeType&&"false"===e.contentEditable}function t(t,n,a,r,i){function d(e,t){if(t=t||0,!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var n=e.index;if(t>0){var a=e[t];if(!a)throw"Invalid capture group";n+=e[0].indexOf(a),e[0]=a}return[n,n+e[0].length,[e[0]]]}function o(t){var n;if(3===t.nodeType)return t.data;if(m[t.nodeName]&&!h[t.nodeName])return"";if(n="",e(t))return"\n";if((h[t.nodeName]||p[t.nodeName])&&(n+="\n"),t=t.firstChild)do{n+=o(t)}while(t=t.nextSibling);return n}function l(t,n,a){var r,i,d,o,l=[],c=0,s=t,f=n.shift(),u=0;e:for(;;){if((h[s.nodeName]||p[s.nodeName]||e(s))&&c++,3===s.nodeType&&(!i&&s.length+c>=f[1]?(i=s,o=f[1]-c):r&&l.push(s),!r&&s.length+c>f[0]&&(r=s,d=f[0]-c),c+=s.length),r&&i){if(s=a({startNode:r,startNodeIndex:d,endNode:i,endNodeIndex:o,innerNodes:l,match:f[2],matchIndex:u}),c-=i.length-o,r=null,i=null,l=[],f=n.shift(),u++,!f)break}else if(m[s.nodeName]&&!h[s.nodeName]||!s.firstChild){if(s.nextSibling){s=s.nextSibling;continue}}else if(!e(s)){s=s.firstChild;continue}for(;;){if(s.nextSibling){s=s.nextSibling;break}if(s.parentNode===t)break e;s=s.parentNode}}}function c(e){var t;if("function"!=typeof e){var n=e.nodeType?e:u.createElement(e);t=function(e,t){var a=n.cloneNode(!1);return a.setAttribute("data-mce-index",t),e&&a.appendChild(u.createTextNode(e)),a}}else t=e;return function(e){var n,a,r,i=e.startNode,d=e.endNode,o=e.matchIndex;if(i===d){var l=i;r=l.parentNode,e.startNodeIndex>0&&(n=u.createTextNode(l.data.substring(0,e.startNodeIndex)),r.insertBefore(n,l));var c=t(e.match[0],o);return r.insertBefore(c,l),e.endNodeIndex<l.length&&(a=u.createTextNode(l.data.substring(e.endNodeIndex)),r.insertBefore(a,l)),l.parentNode.removeChild(l),c}n=u.createTextNode(i.data.substring(0,e.startNodeIndex)),a=u.createTextNode(d.data.substring(e.endNodeIndex));for(var s=t(i.data.substring(e.startNodeIndex),o),f=[],h=0,m=e.innerNodes.length;h<m;++h){var p=e.innerNodes[h],g=t(p.data,o);p.parentNode.replaceChild(g,p),f.push(g)}var v=t(d.data.substring(0,e.endNodeIndex),o);return r=i.parentNode,r.insertBefore(n,i),r.insertBefore(s,i),r.removeChild(i),r=d.parentNode,r.insertBefore(v,d),r.insertBefore(a,d),r.removeChild(d),v}}var s,f,u,h,m,p,g=[],v=0;if(u=n.ownerDocument,h=i.getBlockElements(),m=i.getWhiteSpaceElements(),p=i.getShortEndedElements(),f=o(n)){if(t.global)for(;s=t.exec(f);)g.push(d(s,r));else s=f.match(t),g.push(d(s,r));return g.length&&(v=g.length,l(n,g,c(a))),v}}function n(e){function n(){function t(){i.statusbar.find("#next").disabled(!d(f+1).length),i.statusbar.find("#prev").disabled(!d(f-1).length)}function n(){e.windowManager.alert("Could not find the specified string.",function(){i.find("#find")[0].focus()})}var a,r={};a=tinymce.trim(e.selection.getContent({format:"text"}));var i=e.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){e.focus(),s.done()},onSubmit:function(e){var a,o,l,c;return e.preventDefault(),o=i.find("#case").checked(),c=i.find("#words").checked(),l=i.find("#find").value(),l.length?r.text==l&&r.caseState==o&&r.wholeWord==c?0===d(f+1).length?void n():(s.next(),void t()):(a=s.find(l,o,c),a||n(),i.statusbar.items().slice(1).disabled(0===a),t(),void(r={text:l,caseState:o,wholeWord:c})):(s.done(!1),void i.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){i.submit()}},{text:"Replace",disabled:!0,onclick:function(){s.replace(i.find("#replace").value())||(i.statusbar.items().slice(1).disabled(!0),f=-1,r={})}},{text:"Replace all",disabled:!0,onclick:function(){s.replace(i.find("#replace").value(),!0,!0),i.statusbar.items().slice(1).disabled(!0),r={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){s.prev(),t()}},{text:"Next",name:"next",disabled:!0,onclick:function(){s.next(),t()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:a},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})}function a(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function r(n){var a,r;return r=e.dom.create("span",{"data-mce-bogus":1}),r.className="mce-match-marker",a=e.getBody(),s.done(!1),t(n,a,r,!1,e.schema)}function i(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function d(t){var n,r=[];if(n=tinymce.toArray(e.getBody().getElementsByTagName("span")),n.length)for(var i=0;i<n.length;i++){var d=a(n[i]);null!==d&&d.length&&d===t.toString()&&r.push(n[i])}return r}function o(t){var n=f,a=e.dom;t=!1!==t,t?n++:n--,a.removeClass(d(f),"mce-match-marker-selected");var r=d(n);return r.length?(a.addClass(d(n),"mce-match-marker-selected"),e.selection.scrollIntoView(r[0]),n):-1}function l(t){var n=e.dom,a=t.parentNode;n.remove(t),n.isEmpty(a)&&n.remove(a)}function c(e){var t=a(e);return null!==t&&t.length>0}var s=this,f=-1;s.init=function(e){e.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:n,separator:"before",context:"edit"}),e.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:n}),e.addCommand("SearchReplace",n),e.shortcuts.add("Meta+F","",n)},s.find=function(e,t,n){e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e=n?"\\b"+e+"\\b":e;var a=r(new RegExp(e,t?"g":"gi"));return a&&(f=-1,f=o(!0)),a},s.next=function(){var e=o(!0);-1!==e&&(f=e)},s.prev=function(){var e=o(!1);-1!==e&&(f=e)},s.replace=function(t,n,r){var o,u,h,m,p,g,v=f;for(n=!1!==n,h=e.getBody(),u=tinymce.grep(tinymce.toArray(h.getElementsByTagName("span")),c),o=0;o<u.length;o++){var x=a(u[o]);if(m=p=parseInt(x,10),r||m===f){for(t.length?(u[o].firstChild.nodeValue=t,i(u[o])):l(u[o]);u[++o];){if((m=parseInt(a(u[o]),10))!==p){o--;break}l(u[o])}n&&v--}else p>f&&u[o].setAttribute("data-mce-index",p-1)}return e.undoManager.add(),f=v,n?(g=d(v+1).length>0,s.next()):(g=d(v-1).length>0,s.prev()),!r&&g},s.done=function(t){var n,r,d,o;for(r=tinymce.toArray(e.getBody().getElementsByTagName("span")),n=0;n<r.length;n++){var l=a(r[n]);null!==l&&l.length&&(l===f.toString()&&(d||(d=r[n].firstChild),o=r[n].firstChild),i(r[n]))}if(d&&o){var c=e.dom.createRng();return c.setStart(d,0),c.setEnd(o,o.data.length),!1!==t&&e.selection.setRng(c),c}}}tinymce.PluginManager.add("searchreplace",n)}();