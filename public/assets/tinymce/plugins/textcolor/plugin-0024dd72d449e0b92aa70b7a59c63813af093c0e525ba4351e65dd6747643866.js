tinymce.PluginManager.add("textcolor",function(t){function e(e){var o;return t.dom.getParents(t.selection.getStart(),function(t){var r;(r=t.style["forecolor"==e?"color":"background-color"])&&(o=r)}),o}function o(e){var o,r,l=[];for(r=["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],r=t.settings.textcolor_map||r,r=t.settings[e+"_map"]||r,o=0;o<r.length;o+=2)l.push({text:r[o+1],color:"#"+r[o]});return l}function r(){function e(t,e){var o="transparent"==t;return'<td class="mce-grid-cell'+(o?" mce-colorbtn-trans":"")+'"><div id="'+F+"-"+b+++'" data-mce-color="'+(t||"")+'" role="option" tabIndex="-1" style="'+(t?"background-color: "+t:"")+'" title="'+tinymce.translate(e)+'">'+(o?"&#215;":"")+"</div></td>"}var r,l,n,a,c,u,d,g,m=this,F=m._id,b=0;for(g=m.settings.origin,r=o(g),r.push({text:tinymce.translate("No color"),color:"transparent"}),n='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',a=r.length-1,u=0;u<s[g];u++){for(n+="<tr>",c=0;c<i[g];c++)d=u*i[g]+c,d>a?n+="<td></td>":(l=r[d],n+=e(l.color,l.text));n+="</tr>"}if(t.settings.color_picker_callback){for(n+='<tr><td colspan="'+i[g]+'" class="mce-custom-color-btn"><div id="'+F+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+F+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",n+="<tr>",c=0;c<i[g];c++)n+=e("","Custom color");n+="</tr>"}return n+="</tbody></table>"}function l(e,o){t.undoManager.transact(function(){t.focus(),t.formatter.apply(e,{value:o}),t.nodeChanged()})}function n(e){t.undoManager.transact(function(){t.focus(),t.formatter.remove(e,{value:null},null,!0),t.nodeChanged()})}function a(o){function r(t){d.hidePanel(),d.color(t),l(d.settings.format,t)}function a(){d.hidePanel(),d.resetColor(),n(d.settings.format)}function c(t,e){t.style.background=e,t.setAttribute("data-mce-color",e)}var s,u,d=this.parent();u=d.settings.origin,tinymce.DOM.getParent(o.target,".mce-custom-color-btn")&&(d.hidePanel(),t.settings.color_picker_callback.call(t,function(t){var e,o,l,n=d.panel.getEl().getElementsByTagName("table")[0];for(e=tinymce.map(n.rows[n.rows.length-1].childNodes,function(t){return t.firstChild}),l=0;l<e.length&&(o=e[l],o.getAttribute("data-mce-color"));l++);if(l==i[u])for(l=0;l<i[u]-1;l++)c(e[l],e[l+1].getAttribute("data-mce-color"));c(o,t),r(t)},e(d.settings.format))),s=o.target.getAttribute("data-mce-color"),s?(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),o.target.setAttribute("aria-selected",!0),this.lastId=o.target.id,"transparent"==s?a():r(s)):null!==s&&d.hidePanel()}function c(){var t=this;t._color?l(t.settings.format,t._color):n(t.settings.format)}var i,s;s={forecolor:t.settings.forecolor_rows||t.settings.textcolor_rows||5,backcolor:t.settings.backcolor_rows||t.settings.textcolor_rows||5},i={forecolor:t.settings.forecolor_cols||t.settings.textcolor_cols||8,backcolor:t.settings.backcolor_cols||t.settings.textcolor_cols||8},t.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{origin:"forecolor",role:"application",ariaRemember:!0,html:r,onclick:a},onclick:c}),t.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{origin:"backcolor",role:"application",ariaRemember:!0,html:r,onclick:a},onclick:c})});